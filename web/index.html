<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG Agent API ÊµãËØïÂ∑•ÂÖ∑</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .main-content {
        padding: 30px;
      }

      .status-bar {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 2px solid #e9ecef;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #dc3545;
        animation: pulse 2s infinite;
      }

      .status-dot.online {
        background: #28a745;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .api-section {
        background: #fff;
        border: 2px solid #e9ecef;
        border-radius: 15px;
        margin-bottom: 25px;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .api-section:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .api-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 20px;
        border-bottom: 1px solid #dee2e6;
        cursor: pointer;
        user-select: none;
      }

      .api-header h3 {
        color: #495057;
        font-size: 1.3em;
        margin-bottom: 5px;
      }

      .api-header .method {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: bold;
        text-transform: uppercase;
        margin-right: 10px;
      }

      .method.get {
        background: #d4edda;
        color: #155724;
      }
      .method.post {
        background: #cce5ff;
        color: #004085;
      }
      .method.delete {
        background: #f8d7da;
        color: #721c24;
      }

      .api-content {
        padding: 25px;
        display: none;
      }

      .api-content.active {
        display: block;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
        font-family: "Courier New", monospace;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      }

      .btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      }

      .btn-danger:hover {
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
      }

      .response-area {
        margin-top: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #e9ecef;
      }

      .response-area h4 {
        margin-bottom: 15px;
        color: #495057;
      }

      .response-content {
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        font-family: "Courier New", monospace;
        font-size: 13px;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
      }

      .file-input-wrapper {
        position: relative;
        display: inline-block;
        cursor: pointer;
        width: 100%;
      }

      .file-input {
        opacity: 0;
        position: absolute;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-display {
        padding: 12px;
        border: 2px dashed #667eea;
        border-radius: 8px;
        text-align: center;
        background: #f8f9ff;
        transition: all 0.3s ease;
      }

      .file-input-display:hover {
        background: #f0f4ff;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .success {
        color: #28a745;
      }
      .error {
        color: #dc3545;
      }
      .info {
        color: #17a2b8;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
        text-align: center;
      }

      .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
      }

      .stat-label {
        color: #6c757d;
        margin-top: 5px;
      }

      .json-viewer {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        overflow-x: auto;
      }

      .json-key {
        color: #68d391;
      }
      .json-string {
        color: #f6ad55;
      }
      .json-number {
        color: #4fd1c7;
      }
      .json-boolean {
        color: #f093fb;
      }
      .json-null {
        color: #a0aec0;
      }

      .cleanup-warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        color: #856404;
      }

      .cleanup-warning strong {
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ü§ñ RAG Agent API ÊµãËØïÂ∑•ÂÖ∑</h1>
        <p>ÊµãËØïÂíåÈ™åËØÅ Chalee RAG Agent ÁöÑÊâÄÊúâAPIÊé•Âè£</p>
      </div>

      <div class="main-content">
        <!-- Áä∂ÊÄÅÊ†è -->
        <div class="status-bar">
          <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Ê£ÄÊü•ÊúçÂä°Áä∂ÊÄÅ...</span>
          </div>
          <div>
            <input
              type="text"
              id="apiBaseUrl"
              value="http://localhost:3000"
              placeholder="API Base URL"
              style="
                width: 300px;
                padding: 8px;
                border-radius: 5px;
                border: 1px solid #ccc;
              "
            />
            <button class="btn" onclick="checkHealth()">Ê£ÄÊü•Áä∂ÊÄÅ</button>
          </div>
        </div>

        <!-- 1. ÂÅ•Â∫∑Ê£ÄÊü• -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('health')">
            <h3>
              <span class="method get">GET</span>
              ÂÅ•Â∫∑Ê£ÄÊü• - /health
            </h3>
            <p>Ê£ÄÊü•ÊúçÂä°Âô®ËøêË°åÁä∂ÊÄÅ</p>
          </div>
          <div class="api-content" id="health-content">
            <button class="btn" onclick="testHealth()">
              <span
                id="health-loading"
                style="display: none"
                class="loading"
              ></span>
              ÊµãËØïÂÅ•Â∫∑Ê£ÄÊü•
            </button>
            <div
              class="response-area"
              id="health-response"
              style="display: none"
            >
              <h4>ÂìçÂ∫îÁªìÊûú:</h4>
              <div class="response-content" id="health-result"></div>
            </div>
          </div>
        </div>

        <!-- 2. Êü•ËØ¢Êé•Âè£ -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('query')">
            <h3>
              <span class="method post">POST</span>
              Êô∫ËÉΩÈóÆÁ≠î - /query
            </h3>
            <p>ÂêëRAG AgentÊèêÈóÆÂπ∂Ëé∑ÂèñAIÂõûÁ≠î</p>
          </div>
          <div class="api-content" id="query-content">
            <div class="form-group">
              <label for="queryQuestion">ÈóÆÈ¢ò:</label>
              <textarea
                id="queryQuestion"
                placeholder="ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºö‰ªÄ‰πàÊòØ‰∫∫Â∑•Êô∫ËÉΩÔºü"
              >
‰ªÄ‰πàÊòØRAGÊäÄÊúØÔºü</textarea
              >
            </div>
            <button class="btn" onclick="testQuery()">
              <span
                id="query-loading"
                style="display: none"
                class="loading"
              ></span>
              ÂèëÈÄÅÊü•ËØ¢
            </button>
            <div
              class="response-area"
              id="query-response"
              style="display: none"
            >
              <h4>AIÂõûÁ≠î:</h4>
              <div class="response-content" id="query-result"></div>
            </div>
          </div>
        </div>

        <!-- 3. ÊñáÊ°£‰∏ä‰º† -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('upload')">
            <h3>
              <span class="method post">POST</span>
              ÊñáÊ°£‰∏ä‰º† - /upload
            </h3>
            <p>‰∏ä‰º†ÊñáÊú¨Êñá‰ª∂Âà∞Áü•ËØÜÂ∫ì</p>
          </div>
          <div class="api-content" id="upload-content">
            <div class="form-group">
              <label>ÈÄâÊã©Êñá‰ª∂:</label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  class="file-input"
                  id="uploadFiles"
                  multiple
                  accept=".txt,.md"
                />
                <div class="file-input-display">
                  ÁÇπÂáªÈÄâÊã©ÊñáÊú¨Êñá‰ª∂ (.txt, .md)
                </div>
              </div>
              <div id="fileList" style="margin-top: 10px"></div>
            </div>
            <button class="btn" onclick="testUpload()">
              <span
                id="upload-loading"
                style="display: none"
                class="loading"
              ></span>
              ‰∏ä‰º†Êñá‰ª∂
            </button>
            <div
              class="response-area"
              id="upload-response"
              style="display: none"
            >
              <h4>‰∏ä‰º†ÁªìÊûú:</h4>
              <div class="response-content" id="upload-result"></div>
            </div>
          </div>
        </div>

        <!-- 4. ÊâπÈáèÊ∑ªÂä†ÊñáÊ°£ -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('batch')">
            <h3>
              <span class="method post">POST</span>
              ÊâπÈáèÊ∑ªÂä† - /documents/batch
            </h3>
            <p>ÊâπÈáèÊ∑ªÂä†ÊñáÊ°£Âà∞Áü•ËØÜÂ∫ì</p>
          </div>
          <div class="api-content" id="batch-content">
            <div class="form-group">
              <label for="batchDocuments">ÊñáÊ°£Êï∞ÊçÆ (JSONÊ†ºÂºè):</label>
              <textarea id="batchDocuments" style="height: 150px">
[
  {
    "content": "‰∫∫Â∑•Êô∫ËÉΩÔºàAIÔºâÊòØËÆ°ÁÆóÊú∫ÁßëÂ≠¶ÁöÑ‰∏Ä‰∏™ÂàÜÊîØÔºåÊó®Âú®ÂàõÈÄ†ËÉΩÂ§üÊâßË°åÈÄöÂ∏∏ÈúÄË¶Å‰∫∫Á±ªÊô∫ËÉΩÁöÑ‰ªªÂä°ÁöÑÊú∫Âô®„ÄÇ",
    "source": "ai_definition.txt"
  },
  {
    "content": "Êú∫Âô®Â≠¶‰π†ÊòØ‰∫∫Â∑•Êô∫ËÉΩÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÂ≠êÈ¢ÜÂüüÔºåÂÆÉ‰ΩøËÆ°ÁÆóÊú∫ËÉΩÂ§üÂú®Ê≤°ÊúâÊòéÁ°ÆÁºñÁ®ãÁöÑÊÉÖÂÜµ‰∏ãÂ≠¶‰π†ÂíåÊîπËøõ„ÄÇ",
    "source": "machine_learning.txt"
  }
]</textarea
              >
            </div>
            <button class="btn" onclick="testBatch()">
              <span
                id="batch-loading"
                style="display: none"
                class="loading"
              ></span>
              ÊâπÈáèÊ∑ªÂä†
            </button>
            <button class="btn btn-secondary" onclick="addSampleData()">
              Ê∑ªÂä†Á§∫‰æãÊï∞ÊçÆ
            </button>
            <div
              class="response-area"
              id="batch-response"
              style="display: none"
            >
              <h4>Ê∑ªÂä†ÁªìÊûú:</h4>
              <div class="response-content" id="batch-result"></div>
            </div>
          </div>
        </div>

        <!-- 5. ÊñáÊ°£Ê£ÄÁ¥¢ -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('retrieve')">
            <h3>
              <span class="method post">POST</span>
              ÊñáÊ°£Ê£ÄÁ¥¢ - /retrieve
            </h3>
            <p>Ê£ÄÁ¥¢Áõ∏ÂÖ≥ÊñáÊ°£ÁâáÊÆµ</p>
          </div>
          <div class="api-content" id="retrieve-content">
            <div class="form-group">
              <label for="retrieveQuery">Ê£ÄÁ¥¢Êü•ËØ¢:</label>
              <input
                type="text"
                id="retrieveQuery"
                placeholder="ËæìÂÖ•Ê£ÄÁ¥¢ÂÖ≥ÈîÆËØç"
                value="‰∫∫Â∑•Êô∫ËÉΩ"
              />
            </div>
            <div class="form-group">
              <label for="retrieveTopK">ËøîÂõûÊï∞Èáè:</label>
              <select id="retrieveTopK">
                <option value="3">3‰∏™ÁªìÊûú</option>
                <option value="5" selected>5‰∏™ÁªìÊûú</option>
                <option value="10">10‰∏™ÁªìÊûú</option>
              </select>
            </div>
            <button class="btn" onclick="testRetrieve()">
              <span
                id="retrieve-loading"
                style="display: none"
                class="loading"
              ></span>
              ÂºÄÂßãÊ£ÄÁ¥¢
            </button>
            <div
              class="response-area"
              id="retrieve-response"
              style="display: none"
            >
              <h4>Ê£ÄÁ¥¢ÁªìÊûú:</h4>
              <div class="response-content" id="retrieve-result"></div>
            </div>
          </div>
        </div>

        <!-- 6. ÁªüËÆ°‰ø°ÊÅØ -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('stats')">
            <h3>
              <span class="method get">GET</span>
              ÁªüËÆ°‰ø°ÊÅØ - /stats
            </h3>
            <p>Ëé∑ÂèñÁü•ËØÜÂ∫ìÁªüËÆ°‰ø°ÊÅØ</p>
          </div>
          <div class="api-content" id="stats-content">
            <button class="btn" onclick="testStats()">
              <span
                id="stats-loading"
                style="display: none"
                class="loading"
              ></span>
              Ëé∑ÂèñÁªüËÆ°
            </button>
            <div
              class="response-area"
              id="stats-response"
              style="display: none"
            >
              <h4>ÁªüËÆ°‰ø°ÊÅØ:</h4>
              <div class="stats-grid" id="stats-grid"></div>
              <div class="response-content" id="stats-result"></div>
            </div>
          </div>
        </div>

        <!-- 7. Ê∏ÖÁêÜÁü•ËØÜÂ∫ì -->
        <div class="api-section">
          <div class="api-header" onclick="toggleSection('cleanup')">
            <h3>
              <span class="method delete">DELETE</span>
              Ê∏ÖÁêÜÁü•ËØÜÂ∫ì - /cleanup
            </h3>
            <p>Ê∏ÖÁ©∫ÊâÄÊúâÊñáÊ°£ÂíåÂêëÈáèÊï∞ÊçÆ</p>
          </div>
          <div class="api-content" id="cleanup-content">
            <div class="cleanup-warning">
              <strong>‚ö†Ô∏è Âç±Èô©Êìç‰ΩúË≠¶Âëä</strong><br />
              Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§Áü•ËØÜÂ∫ì‰∏≠ÁöÑÊâÄÊúâÊñáÊ°£ÂíåÂêëÈáèÊï∞ÊçÆÔºåÂπ∂‰∏îÊó†Ê≥ïÊí§ÈîÄ„ÄÇËØ∑Á°ÆËÆ§ÊÇ®ÁúüÁöÑË¶ÅÊ∏ÖÁ©∫Êï¥‰∏™Áü•ËØÜÂ∫ì„ÄÇ
            </div>

            <div class="form-group">
              <label for="cleanupConfirm"
                >Á°ÆËÆ§Êìç‰Ωú (ËØ∑ËæìÂÖ• "CONFIRM" ‰ª•ÁªßÁª≠):</label
              >
              <input
                type="text"
                id="cleanupConfirm"
                placeholder="ËæìÂÖ• CONFIRM"
                maxlength="7"
              />
            </div>

            <button class="btn btn-danger" onclick="testCleanup()">
              <span
                id="cleanup-loading"
                style="display: none"
                class="loading"
              ></span>
              üóëÔ∏è Ê∏ÖÁ©∫Áü•ËØÜÂ∫ì
            </button>

            <div
              class="response-area"
              id="cleanup-response"
              style="display: none"
            >
              <h4>Ê∏ÖÁêÜÁªìÊûú:</h4>
              <div class="response-content" id="cleanup-result"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Ëé∑ÂèñAPIÂü∫Á°ÄURL
      function getApiBaseUrl() {
        return document.getElementById("apiBaseUrl").value.trim();
      }

      // ÊòæÁ§∫/ÈöêËóèAPIÈÉ®ÂàÜ
      function toggleSection(sectionId) {
        const content = document.getElementById(sectionId + "-content");
        content.classList.toggle("active");
      }

      // ÈªòËÆ§Â±ïÂºÄÁ¨¨‰∏Ä‰∏™ÈÉ®ÂàÜ
      document.getElementById("health-content").classList.add("active");

      // ÊòæÁ§∫ÂìçÂ∫îÁªìÊûú
      function showResponse(sectionId, data, isError = false) {
        const responseArea = document.getElementById(sectionId + "-response");
        const resultDiv = document.getElementById(sectionId + "-result");

        responseArea.style.display = "block";

        if (typeof data === "object") {
          resultDiv.innerHTML = formatJson(data);
        } else {
          resultDiv.textContent = data;
        }

        resultDiv.className =
          "response-content " + (isError ? "error" : "success");
      }

      // Ê†ºÂºèÂåñJSONÊòæÁ§∫
      function formatJson(obj) {
        return (
          '<div class="json-viewer">' +
          syntaxHighlight(JSON.stringify(obj, null, 2)) +
          "</div>"
        );
      }

      // JSONËØ≠Ê≥ïÈ´ò‰∫Æ
      function syntaxHighlight(json) {
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
          function (match) {
            var cls = "json-number";
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "json-key";
              } else {
                cls = "json-string";
              }
            } else if (/true|false/.test(match)) {
              cls = "json-boolean";
            } else if (/null/.test(match)) {
              cls = "json-null";
            }
            return '<span class="' + cls + '">' + match + "</span>";
          }
        );
      }

      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      function showLoading(sectionId, show = true) {
        const loadingEl = document.getElementById(sectionId + "-loading");
        if (loadingEl) {
          loadingEl.style.display = show ? "inline-block" : "none";
        }
      }

      // ÈÄöÁî®APIËØ∑Ê±ÇÂáΩÊï∞
      async function apiRequest(
        method,
        endpoint,
        data = null,
        isFormData = false
      ) {
        const url = getApiBaseUrl() + endpoint;
        const options = {
          method: method,
          headers: {},
        };

        if (data && !isFormData) {
          options.headers["Content-Type"] = "application/json";
          options.body = JSON.stringify(data);
        } else if (data && isFormData) {
          options.body = data;
        }

        try {
          const response = await fetch(url, options);
          const result = await response.json();

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${result.error || "ËØ∑Ê±ÇÂ§±Ë¥•"}`
            );
          }

          return result;
        } catch (error) {
          console.error("APIËØ∑Ê±ÇÈîôËØØ:", error);
          throw error;
        }
      }

      // 1. ÂÅ•Â∫∑Ê£ÄÊü•
      async function checkHealth() {
        await testHealth();
      }

      async function testHealth() {
        showLoading("health");
        try {
          const result = await apiRequest("GET", "/health");
          showResponse("health", result);

          // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
          const statusDot = document.getElementById("statusDot");
          const statusText = document.getElementById("statusText");
          statusDot.classList.add("online");
          statusText.textContent = "ÊúçÂä°Ê≠£Â∏∏ËøêË°å";
          statusText.className = "success";
        } catch (error) {
          showResponse("health", { error: error.message }, true);

          // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
          const statusDot = document.getElementById("statusDot");
          const statusText = document.getElementById("statusText");
          statusDot.classList.remove("online");
          statusText.textContent = "ÊúçÂä°ËøûÊé•Â§±Ë¥•";
          statusText.className = "error";
        } finally {
          showLoading("health", false);
        }
      }

      // 2. Êü•ËØ¢Êé•Âè£
      async function testQuery() {
        const question = document.getElementById("queryQuestion").value.trim();
        if (!question) {
          alert("ËØ∑ËæìÂÖ•ÈóÆÈ¢ò");
          return;
        }

        showLoading("query");
        try {
          const result = await apiRequest("POST", "/query", { question });
          showResponse("query", result);
        } catch (error) {
          showResponse("query", { error: error.message }, true);
        } finally {
          showLoading("query", false);
        }
      }

      // 3. Êñá‰ª∂‰∏ä‰º†
      function updateFileList() {
        const files = document.getElementById("uploadFiles").files;
        const fileList = document.getElementById("fileList");

        if (files.length > 0) {
          let html = "<h5>Â∑≤ÈÄâÊã©ÁöÑÊñá‰ª∂:</h5><ul>";
          for (let i = 0; i < files.length; i++) {
            html += `<li>${files[i].name} (${(files[i].size / 1024).toFixed(
              1
            )} KB)</li>`;
          }
          html += "</ul>";
          fileList.innerHTML = html;
        } else {
          fileList.innerHTML = "";
        }
      }

      document
        .getElementById("uploadFiles")
        .addEventListener("change", updateFileList);

      async function testUpload() {
        const files = document.getElementById("uploadFiles").files;
        if (files.length === 0) {
          alert("ËØ∑ÈÄâÊã©Êñá‰ª∂");
          return;
        }

        const formData = new FormData();
        for (let i = 0; i < files.length; i++) {
          formData.append("documents", files[i]);
        }

        showLoading("upload");
        try {
          const result = await apiRequest("POST", "/upload", formData, true);
          showResponse("upload", result);
        } catch (error) {
          showResponse("upload", { error: error.message }, true);
        } finally {
          showLoading("upload", false);
        }
      }

      // 4. ÊâπÈáèÊ∑ªÂä†ÊñáÊ°£
      async function testBatch() {
        const documentsText = document
          .getElementById("batchDocuments")
          .value.trim();
        if (!documentsText) {
          alert("ËØ∑ËæìÂÖ•ÊñáÊ°£Êï∞ÊçÆ");
          return;
        }

        try {
          const documents = JSON.parse(documentsText);

          showLoading("batch");
          const result = await apiRequest("POST", "/documents/batch", {
            documents,
          });
          showResponse("batch", result);
        } catch (error) {
          if (error instanceof SyntaxError) {
            showResponse(
              "batch",
              { error: "JSONÊ†ºÂºèÈîôËØØ: " + error.message },
              true
            );
          } else {
            showResponse("batch", { error: error.message }, true);
          }
        } finally {
          showLoading("batch", false);
        }
      }

      // Ê∑ªÂä†Á§∫‰æãÊï∞ÊçÆ
      function addSampleData() {
        const sampleData = [
          {
            content:
              "Node.js ÊòØ‰∏Ä‰∏™Âü∫‰∫é Chrome V8 ÂºïÊìéÁöÑ JavaScript ËøêË°åÊó∂ÁéØÂ¢É„ÄÇÂÆÉÂÖÅËÆ∏ÂºÄÂèëËÄÖÂú®ÊúçÂä°Âô®Á´ØËøêË°å JavaScript ‰ª£Á†ÅÔºåÂÖ∑Êúâ‰∫ã‰ª∂È©±Âä®„ÄÅÈùûÈòªÂ°û I/O Ê®°ÂûãÁ≠âÁâπÁÇπ„ÄÇ",
            source: "nodejs_intro.txt",
          },
          {
            content:
              "Express.js ÊòØ Node.js ÊúÄÊµÅË°åÁöÑ Web Â∫îÁî®Ê°ÜÊû∂‰πã‰∏Ä„ÄÇÂÆÉÊèê‰æõ‰∫Ü‰∏ÄÂ•óÂº∫Â§ßÁöÑÂäüËÉΩÊù•ÂºÄÂèë Web ÂíåÁßªÂä®Â∫îÁî®Á®ãÂ∫èÔºåÁÆÄÂåñ‰∫ÜÊúçÂä°Âô®ÂàõÂª∫ËøáÁ®ã„ÄÇ",
            source: "express_intro.txt",
          },
          {
            content:
              "RESTful API ÊòØ‰∏ÄÁßçÂü∫‰∫é REST Êû∂ÊûÑÈ£éÊ†ºÁöÑÂ∫îÁî®Á®ãÂ∫èÊé•Âè£„ÄÇÂÆÉ‰ΩøÁî®Ê†áÂáÜÁöÑ HTTP ÊñπÊ≥ïÊù•Êìç‰ΩúËµÑÊ∫êÔºåÂÖ∑ÊúâÊó†Áä∂ÊÄÅ„ÄÅÂèØÁºìÂ≠ò„ÄÅÁªü‰∏ÄÊé•Âè£Á≠âÁâπÁÇπ„ÄÇ",
            source: "restful_api.txt",
          },
        ];

        document.getElementById("batchDocuments").value = JSON.stringify(
          sampleData,
          null,
          2
        );
      }

      // 5. ÊñáÊ°£Ê£ÄÁ¥¢
      async function testRetrieve() {
        const query = document.getElementById("retrieveQuery").value.trim();
        const topK = parseInt(document.getElementById("retrieveTopK").value);

        if (!query) {
          alert("ËØ∑ËæìÂÖ•Ê£ÄÁ¥¢Êü•ËØ¢");
          return;
        }

        showLoading("retrieve");
        try {
          const result = await apiRequest("POST", "/retrieve", { query, topK });
          showResponse("retrieve", result);
        } catch (error) {
          showResponse("retrieve", { error: error.message }, true);
        } finally {
          showLoading("retrieve", false);
        }
      }

      // 6. ÁªüËÆ°‰ø°ÊÅØ
      async function testStats() {
        showLoading("stats");
        try {
          const result = await apiRequest("GET", "/stats");
          showResponse("stats", result);

          // ÊòæÁ§∫ÁªüËÆ°Âç°Áâá
          const statsGrid = document.getElementById("stats-grid");
          statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${
                          result.documentCount || 0
                        }</div>
                        <div class="stat-label">ÊñáÊ°£Êï∞Èáè</div>
                    </div>
                `;
        } catch (error) {
          showResponse("stats", { error: error.message }, true);
        } finally {
          showLoading("stats", false);
        }
      }

      // 7. Ê∏ÖÁêÜÁü•ËØÜÂ∫ì
      async function testCleanup() {
        const confirmInput = document
          .getElementById("cleanupConfirm")
          .value.trim();
        if (confirmInput !== "CONFIRM") {
          alert("ËØ∑Á°ÆËÆ§ËæìÂÖ• 'CONFIRM' ‰ª•ÁªßÁª≠");
          return;
        }

        showLoading("cleanup");
        try {
          const result = await apiRequest("POST", "/cleanup");
          showResponse("cleanup", result);
        } catch (error) {
          showResponse("cleanup", { error: error.message }, true);
        } finally {
          showLoading("cleanup", false);
        }
      }
      // È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®Ê£ÄÊü•ÂÅ•Â∫∑Áä∂ÊÄÅ
      window.addEventListener("load", function () {
        setTimeout(checkHealth, 1000);
      });

      // Ëá™Âä®Âà∑Êñ∞Áä∂ÊÄÅ
      setInterval(checkHealth, 30000); // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
    </script>
  </body>
</html>
